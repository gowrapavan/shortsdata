name: Fetch Football Stats

on:
  schedule:
    # Run every 30 minutes from 12:30 UTC (6 PM IST) to 21:30 UTC (3 AM IST)
    - cron: "30 12-20 * * *"   # 12:30, 13:30, ..., 20:30 UTC
    - cron: "0 13-21 * * *"    # 13:00, 14:00, ..., 21:00 UTC
  workflow_dispatch:  # Allow manual trigger

jobs:
  fetch-stats:
    runs-on: ubuntu-latest

    permissions:
      contents: write  # âœ… Required for committing and pushing changes

    steps:
      - name: ğŸ›ï¸ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # âœ… ensures full history for safe rebasing

      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: ğŸ“¦ Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests pytz  # âœ… no need for requirements.txt unless you have one

      - name: âš½ Run Football Stats Script
        run: |
          echo "ğŸš€ Running stats update..."
          python stats.py  # âœ… make sure your script filename matches exactly

      - name: ğŸ§© Commit and Push Updated Stats
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add stats/*.json
          git diff --cached --quiet || git commit -m "âš½ Auto-update football stats ($(date -u '+%Y-%m-%d %H:%M:%S UTC'))"
          git pull --rebase origin main || true
          git push origin main || true
